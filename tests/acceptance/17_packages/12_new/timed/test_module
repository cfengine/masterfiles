#!/usr/bin/python

from __future__ import print_function

import sys
import os
import re

if sys.argv[1] == "supports-api-version":
    print("1")
    exit(0)

module_dir = os.path.dirname(sys.argv[0])

log = open(module_dir + "/test_module.log", "a")
print(sys.argv[1], file=log)
log.close()

pkg_name = ""

for line in sys.stdin:
    match = re.match("^File=(.*)", line)
    if match:
        pkg_name = match.group(1)

if sys.argv[1] == "list-installed":
    print("Name=cfe-present-package\nVersion=1\nArchitecture=amd64")
elif sys.argv[1] == "list-updates" or sys.argv[1] == "list-updates-local":
    log = open(module_dir + "/test_module.log", "r")
    found = False
    for line in log:
        if re.search("repo-install", line):
            found = True
            break
    # Don't print anything if repo-install has been called. We simulate having
    # installed the update.
    if not found:
        print("Name=cfe-present-package\nVersion=3\nArchitecture=amd64")
elif sys.argv[1] == "get-package-data":
    print("PackageType=repo\nName=" + pkg_name)

exit(0)
